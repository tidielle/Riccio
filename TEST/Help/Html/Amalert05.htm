<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<title> AM: Alert di tipo e-mail per clienti/fornitori</title>
<LINK rel=stylesheet type=text/css href="style_topic.css">
<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
loadImage1 = new Image();
loadImage1.src = "../images/help_home_Button_01_Roll-over.gif";
staticImage1 = new Image();
staticImage1.src = "../images/help_home_Button_01_Roll-out.gif";

loadImage2 = new Image();
loadImage2.src = "../images/help_home_Button_02_Roll-over.gif";
staticImage2 = new Image();
staticImage2.src = "../images/help_home_Button_02_Roll-out.gif";

loadImage3 = new Image();
loadImage3.src = "../images/help_home_Button_03_Roll-over.gif";
staticImage3 = new Image();
staticImage3.src = "../images/help_home_Button_03_Roll-out.gif";

loadImage4 = new Image();
loadImage4.src = "../images/help_home_Button_04_Roll-over.gif";
staticImage4 = new Image();
staticImage4.src = "../images/help_home_Button_04_Roll-out.gif";

// End -->
</SCRIPT>

</head>
<body lang=it topMargin=3>
<TABLE width=987 border=0><TR><TD vAlign=top align=right><p><code>Data ultimo aggiornamento: <A name=hINIeDATlAGGp></A>22/01/2016</FONT><A name=hFINeDATlAGGp></A></code></p></TD></TR></TABLE><TABLE cellSpacing=0 border=0><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_banner.gif"></A></TD></TR></TABLE><TABLE cellSpacing=0 cellPadding=0 border=0><TR><TD align=left><A onmouseover="image1.src=loadImage1.src;" onmouseout="image1.src=staticImage1.src;" href="cose.htm"><IMG border=0 name=image1 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_01_Roll-out.gif"></A></TD><TD align=center><A onmouseover="image2.src=loadImage2.src;" onmouseout="image2.src=staticImage2.src;" href="pc.htm"><IMG border=0 name=image2 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_02_Roll-out.gif"></A></TD><TD align=center><A href="ambsargmod.htm"><IMG border=0 name=image3 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_03_Roll-over.gif"></A></TD><TD align=right><A onmouseover="image4.src=loadImage4.src;" onmouseout="image4.src=staticImage4.src;" href="gaguidaan.htm"><IMG border=0 name=image4 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_04_Roll-out.gif"></A></TD></TR><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_Button_03_Roll-over-row.gif"></A></TD></TR><TR><TD bgColor=#009ee2 height=53 vAlign=middle colSpan=4 align=left><p><FONT class=title color=white size=6><b>Alert di tipo e-mail per clienti/fornitori</b></FONT></p></TD></TR><TR><TD vAlign=middle colSpan=4 align=left></TD></TR></TABLE><TABLE width=987 border=0>
<TR>
<TD>
<p>è possibile indicare fra i destinatari dell'alert anche:</p>
<ul>
<li>un cliente/fornitore
<li>una risorsa dell'organizzazione del cliente/fornitore avente un determinato ruolo</li>
</ul>
<p>Per indicare fra i destinatari un cliente/fornitore inserire la parola chiave CONTO, per indicare fra i destinatari la risorsa avente un determinato ruolo all'interno dell'organizzazione di un cliente/fornitore, inserire la parola chiave CONTO seguita da / e dal codice del ruolo. Per esempio:</p>
<p>davide;gian;roby;CONTO;CONTO/RACQ;CONTO/PROD;</p>
<ul>
<li>3 operatori interni: Roby, Gian, Davide (indirizzo e-mail dalla organizzazione interna della azienda)
<li>1 cliente/fornitore (indirizzo e-mail dalla loro anagrafica)
<li>2 risorse del cliente/fornitore (RACQ responsabile acquisti, PROD responsabile produzione, indirizzi e-mail dalla organizzazione del cliente/fornitore)</li>
</ul>
<p>La risoluzione della parola chiave CONTO, avverrà nel codice al momento del riempimento del recordset disconnesso <code>dynMsgoutParam</code> che adesso contiene un nuovo parametro <code>strConto</code> di tipo stringa. Se il parametro non è settato assumerà il valore di default = 0 (nessun conto), altrimenti bisognerà assegnare il codice del conto voluto. Per esempio se il cliente/fornitore fosse il cliente "Rossi Gilbo", avente conto "4010001" la riga di codice dovrebbe essere scritta così: <code>dynMsgoutParam("strConto") = "4010001"</code>.</p>
<p>
<b>NB:</b> se si indica un CONTO e manca il codice cliente non viene inviato nulla. Il CONTO è utilizzato solo per e-mail, non popup. Se è indicato CONTO/ruolo ma non sono presenti ruoli nell'anagrafica del cliente uguale a quello impostato, oppure non c'è nessun ruolo con indirizzo e-mail impostato viene inviato il messaggio all'indirizzo e-mail generico del cliente. Se sono presenti più operatori appartenenti al ruolo a cui inviare l'e-mail nell'anagrafica del cliente viene inviata l'e-mail a tutti.</p>
<p>E' possibile rendere l'oggetto dell'e-mail parametrico mediante i marcatori [#RAGSOC], [#CONTO] e [#DATA] che Business sostituisce rispettivamente con ragione sociale, conto del cliente/fornitore indicato nel parametro strConto del datatable degli alert da generare e data esecuzione dell'alert.</p>
<p>
<b>
<i>
<u>Esempio 1 Creazione di un alert .NET con script .NET su procedura</u>
</i>
</b>
</p>
<p>Creare ad esempio l'alert sotto 99998</p>
<p>
<IMG src="../images/help_amalert05_01.gif">
</p>
<p>creare la procedura 99998, con la spunta di procedura .NET</p>
<p>
<IMG src="../images/help_amalert05_03.gif">
</p>
<p>e compilarla come segue</p>
<p>
<IMG src="../images/help_amalert05_04.gif">
</p>
<p>
<pre><code>  Function ProvaAlert(ByRef oApp As CLE__APP, ByVal strCodditt As String, _
                      ByRef dttMsgOutParam As DataTable) As Boolean
    Try
      dttMsgOutParam.rows.add(dttMsgOutParam.newrow())
      If strCodditt.trim &lt;&gt; "" Then
        dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!codditt = strCodditt
      Else
        dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!codditt = oApp.Ditta
      End If
      dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!strMsg = "Testo di prova email"
      'serve solo se deve essere mandata una e-mail al cliente
      dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!strConto = "4010001"
      dttMsgOutParam.AcceptChanges()
      Return True
    Catch ex As Exception
      Throw (New NTSException(GestError(ex, Me, "", oApp.InfoError, "", False)))
      Return False
    End Try
  End Function</code></pre>
<p>
<b>
<i>
<u>Esempio 1bis Creazione di un alert .NET con script .NET su procedura</u>
</i>
</b>
</p>
<p>Sempre inerente all'esempio sopra, volendo mandare una mail non ad un cliente specifico, ma a diversi la procedura da realizzare sarà:</p>
<p>
<pre><code>  Function ProvaAlert(ByRef oApp As CLE__APP, ByVal strCodditt As String, _
                    ByRef dttMsgOutParam As DataTable) As Boolean
    Try

    Dim strSQL As String = ""
    Dim dttTmp As New DataTable
    Dim oCldBase As New CLD__BASE
    Dim strMsg As String = ""
    Dim i As Integer = 0

    strSQL = "SELECT * FROM anagra WHERE an_tipo='C' and (not (an_email is null))"
    'MsgBox(strSQL)
    oCldBase.Init(oApp)
    dttTmp = oCldBase.OpenRecordset(strSQL, NTSInformatica.CLE__APP.DBTIPO.DBAZI)
    If dttTmp.Rows.Count &gt; 0 Then
      'ho trovato dei clienti
      For i = 0 To dttTmp.Rows.Count - 1

        dttMsgOutParam.rows.add(dttMsgOutParam.newrow())
        If strCodditt.trim &lt;&gt; "" Then
          dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!codditt = strCodditt
        Else
          dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!codditt = oApp.Ditta
        End If
        dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!strMsg = "Visita il nostro sito."
        dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!strConto = dttTmp.Rows(i)!an_conto
        dttMsgOutParam.AcceptChanges()

      Next
    End If
    Return True
    Catch ex As Exception
      Throw (New NTSException(GestError(ex, Me, "", oApp.InfoError, "", False)))
      Return False
    End Try
  End Function</code></pre>
<p>
<b>
<i>
<u>Esempio 2 Creazione di un alert .NET con script .NET su file script esterno</u>
</i>
</b>
</p>
<p>Creare ad esempio l'alert sotto 99999</p>
<p>
<IMG src="../images/help_amalert05_02.gif">
</p>
<p>creare la procedura 99999</p>
<p>
<IMG src="../images/help_amalert05_03.gif">
</p>
<p>e compilarla come segue</p>
<p>
<IMG src="../images/help_amalert05_05.gif">
</p>
<p>
<pre><code>FILE:BE__PROVAALERTNET.NTS
FUNCTION:ProvaAlert</code></pre>
<p>Il codice sotto va poi inserito all'interno del file di script BE__PROVAALERTNET.NTS, da copiare nella Bus\Script del server.</p>
<p>
<pre><code>&lt;nts&gt;


<br>&lt;reference assembly="BD__BASE.dll" /&gt;</code></pre>
<pre><code>&lt;scriptCode&gt;&lt;![CDATA[</code></pre>
<pre><code>Imports Microsoft.VisualBasic


<br>Imports System


<br>Imports System.Collections.Generic


<br>Imports System.Data


<br>Imports NTSInformatica.CLN__STD


<br>Imports NTSInformatica


<br>Imports NTSInformatica.CLD__BASE</code></pre>
<pre><code>Public Class BE__PROVAALERTNETVBS 


<br>    Implements INT__SCRIPT</code></pre>
<pre><code>  Public Function Exec(ByVal strCommand As String, ByRef oApp As Object, ByRef oIn As Object, _


<br>                       ByRef oParam As Object) As Object Implements INT__SCRIPT.Exec


<br>    Try


<br>      If strCommand.ToUpper = "PROVAALERT" Then


<br>        Return ProvaAlert(CType(oApp, CLE__APP), CType(oIn, String), CType(oParam, DataTable))


<br>      End If


<br>      Return True


<br>    Catch ex As Exception


<br>      Throw (New NTSException(GestError(ex, Me, "", oApp.InfoError, "", False)))


<br>      Return False


<br>    End Try


<br>  End Function</code></pre>
<pre><code>  Function ProvaAlert(ByRef oApp As CLE__APP, ByVal strCodditt As String, _


<br>                      ByRef dttMsgOutParam As DataTable) As Boolean


<br>    Try


<br>      dttMsgOutParam.rows.add(dttMsgOutParam.newrow())


<br>      If strCodditt.trim &lt;&gt; "" Then


<br>        dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!codditt = strCodditt


<br>      Else


<br>        dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!codditt = oApp.Ditta


<br>      End If


<br>      dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!strMsg = "Testo di prova email"


<br>      'serve solo se deve essere mandata una e-mail al cliente


<br>      dttMsgOutParam.rows(dttMsgOutParam.rows.count - 1)!strConto = "4010001"


<br>      dttMsgOutParam.AcceptChanges()


<br>      Return True


<br>    Catch ex As Exception


<br>      Throw (New NTSException(GestError(ex, Me, "", oApp.InfoError, "", False)))


<br>      Return False


<br>    End Try


<br>  End Function</code></pre>
<pre><code>End Class]]&gt;</code></pre>
<pre><code>&lt;/scriptCode&gt;


<br>&lt;/nts&gt;</code></pre>
<p>Per provare gli script crati e possibile farlo tramite l'apposito programma di esecuzione alert:</p>
<p>
<IMG src="../images/help_amalert05_06.gif">
</p>
<p>
<IMG src="../images/help_amalert05_07.gif">
</p>
<p>
<IMG src="../images/help_amalert05_08.gif">
</p>
<p>al momento dell'effettivo invio potrebbe comparire la finestra sotto da confermare</p>
<p>
<IMG src="../images/help_amalert05_09.gif">
</p>
<p>a questo punto le due e-mail sono inviate</p>
<p>
<IMG src="../images/help_amalert05_10.gif">
</p>
</TD></TR></TABLE><TABLE border=0 cellSpacing=0 cellPadding=0><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/software-retail-negozi/"><IMG border=0 src="../images/help_home_01_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/controllo-di-gestione/"><IMG border=0 src="../images/help_home_02_Controlla.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/crm/"><IMG border=0 src="../images/help_home_03_Fidelizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/analisi-dati-datawarehouse/"><IMG border=0 src="../images/help_home_04_DWH.gif"></A></TD><TD vAlign=center width=169 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/project-management/"><IMG border=0 src="../images/help_home_05_Gestisci.gif"></A></TD><TD vAlign=center width=146 align=right><IMG border=0 src="../images/help_home_NTS_logo_up.gif"></TD></TR><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/logistica/"><IMG border=0 src="../images/help_home_06_Organizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/customer-service/"><IMG border=0 src="../images/help_home_07_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/produzione/"><IMG border=0 src="../images/help_home_08_Pianifica.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/archiviazione-documenti/"><IMG border=0 src="../images/help_home_09_Archivia.gif"></A></TD><TD vAlign=center width=169 align=right><IMG border=0 src="../images/help_home_NTS_logo_down1.gif"></TD><TD vAlign=center width=146 align=right><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_NTS_logo_down2.gif"></A></TD></TR><TR><TD width=987 colSpan=6><IMG border=0 src="../images/help_home_Line.gif"></TD></TR></TABLE></body></html>