<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<title> GA: Definizione procedure import/export e alerting</title>
<LINK rel=stylesheet type=text/css href="style_topic.css">
<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
loadImage1 = new Image();
loadImage1.src = "../images/help_home_Button_01_Roll-over.gif";
staticImage1 = new Image();
staticImage1.src = "../images/help_home_Button_01_Roll-out.gif";

loadImage2 = new Image();
loadImage2.src = "../images/help_home_Button_02_Roll-over.gif";
staticImage2 = new Image();
staticImage2.src = "../images/help_home_Button_02_Roll-out.gif";

loadImage3 = new Image();
loadImage3.src = "../images/help_home_Button_03_Roll-over.gif";
staticImage3 = new Image();
staticImage3.src = "../images/help_home_Button_03_Roll-out.gif";

loadImage4 = new Image();
loadImage4.src = "../images/help_home_Button_04_Roll-over.gif";
staticImage4 = new Image();
staticImage4.src = "../images/help_home_Button_04_Roll-out.gif";

// End -->
</SCRIPT>

</head>
<body lang=it topMargin=3>
<TABLE width=987 border=0><TR><TD vAlign=top align=right><p><code>Data ultimo aggiornamento: <A name=hINIeDATlAGGp></A>21/01/2016</FONT><A name=hFINeDATlAGGp></A></code></p></TD></TR></TABLE><TABLE cellSpacing=0 border=0><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_banner.gif"></A></TD></TR></TABLE><TABLE cellSpacing=0 cellPadding=0 border=0><TR><TD align=left><A onmouseover="image1.src=loadImage1.src;" onmouseout="image1.src=staticImage1.src;" href="cose.htm"><IMG border=0 name=image1 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_01_Roll-out.gif"></A></TD><TD align=center><A onmouseover="image2.src=loadImage2.src;" onmouseout="image2.src=staticImage2.src;" href="pc.htm"><IMG border=0 name=image2 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_02_Roll-out.gif"></A></TD><TD align=center><A onmouseover="image3.src=loadImage3.src;" onmouseout="image3.src=staticImage3.src;" href="ambsargmod.htm"><IMG border=0 name=image3 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_03_Roll-out.gif"></A></TD><TD align=right><A href="gaguidaan.htm"><IMG border=0 name=image4 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_04_Roll-over.gif"></A></TD></TR><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_Button_04_Roll-over-row.gif"></A></TD></TR><TR><TD bgColor=#009ee2 height=53 vAlign=middle width=987 colSpan=4 align=left><p><FONT class=title color=white size=6><b>Definizione procedure import/export e alerting</b></FONT></p></TD></TR><TR><TD vAlign=middle colSpan=4 align=left></TD></TR></TABLE><TABLE width=987 border=0>
<TR>
<TD>
<p>
<b>Nome programma: BSIEPROC.DLL</b>
<br>
<b>Moduli richiesti: Qualsiasi</b>
</p>
<p>Le procedure sono delle porzioni di codice in linguaggio VB.NET (o VBScript solo nel caso di precaricate per il CP2) che l'utente può impostare, allo scopo di eseguire delle operazioni sui dati non previste o particolari. Le procedure quì create possono essere usate da:</p>
<ul>
<li>Profili di import/export <ul>
<li>attribuire un valore ad un campo nella corrispondenza campi, in questo caso la procedura sarà una <u>Function</u> che restituirà un dato del tipo che il campo di destinazione accetta
<li>eseguire operazioni particolari prima o dopo aver scritto tutti i record, prima o dopo l'entrata in una relazione fra tabelle oppure prima o dopo la scrittura di un record, in questo caso la procedura sarà una <u>Sub</u>
</li>
</ul>
<li>Alert <ul>
<li>per attribuire una procedura per condizionare la generazione di un alert
<li>per attribuire una procedura da eseguire allo scattare di un alert</li>
</ul>
<li>Configuratore di prodotto su distinta base neutra (CP2)</li>
</ul>
<p>
<u>1 - Elenco Procedure</u>
</p>
<p>
<IMG src="../images/help_Bsieproc_01.jpg">
</p>
<p>
<b>
<A name=Codice>Codice</A>
</b>
</p>
<p>Campo numerico univoco che identifica una procedura. I codici compresi tra 1 e 1000 sono riservati NTS mentre quelli superiori a 1000 sono disponibili all'utente.</p>
<p>
<b>
<A name=Descrizione>Descrizione</A>
</b>
</p>
<p>Rappresenta la descrizione della procedura, come il codice anche la descrizione della procedura deve essere univoca.</p>
<p>
<b>
<A name=Tipoprocedura>Tipo procedura</A>
</b>
</p>
<p>Rappresenta il tipo della procedura e può assumere 4 valori:</p>
<ul>
<li>
<u>Function</u>: sono procedure, racchiuese fra le parole chiave <i>Function - End Function</i>, devono restituire in uscita un valore.
<li>
<u>Sub</u>: sono procedure, racchiuse fra le parole chiave <i>Sub - End Sub, </i>che non restituiscono valori ma eseguono solo delle operazioni
<li>
<u>Expression</u> e <u>SQL Query</u>: non gestiti</li>
</ul>
<p>
<b>
<A name=Precarica>Precarica</A>
</b>
</p>
<p>Flag che indica se precaricare la procedura all'avvio del processo di Import/Export oppure caricare la procedura nello Script Engine immediatamente prima dell'uso. Procedure che hanno un uso frequente è consigliabile precericarle.</p>
<p>
<b>
<A name=ProcInVbNET>Proc. in Vb.Net</A>
</b>
</p>
<p>Indicare con tale spunta se la procedura è definita in linguaggio VB.NET (o VBScript solo nel caso di precaricate per il CP2).</p>
<p>
<u>2 - Corpo Procedura</u>
</p>
<p>
<IMG src="../images/help_Bsieproc_03.jpg">
</p>
<p>Normalmente l'editor delle procedure è disabilitato; per abilitarlo premere sul pulsante 'Modifica'. Terminata la modifica o l'inserimento della nuova procedura è possibile salvare o ripristinare il tutto; il pulsante controlla, se abilitato, consente di controllare la sintassi solo per procedure di tipo <i>Sub, Function </i>o <i>Expression.</i>
</p>
<p>
<b>
<i>
<u>Import/Export</u>
</i>
</b>
</p>
<p>Negli script, per aggiungere degli 'Imports' e/o dei 'Reference' occore utilizzare la seguente sintassi (devono essere scritti fuori dalle function/sub):</p>
<pre><code>&lt;reference assembly="BN__STD.dll" /&gt;

Imports NTSInformatica.CLN__STD</code></pre>
<p>Gli imports passati per default dal framework di busnet sono:</p>
<pre><code>Imports Microsoft.visualbasic
Imports System
Imports System.Collections
Imports System.Data
Imports NTSInformatica
Imports NTSInformatica.CLN__STD</code></pre>
<p>
<br>Gli oggetti/variabili pubblici sempre disponibili in tutti gli script .Net sono i seguenti:</p>
<ul>
<li>oApp
<li>oMenu
<li>oCleComm
<li>oCleImex 
<br>tra le sue funzioni permette di scrivere un messaggio nel file di log del processo di import/export (B?IEIMPO*.LOG) col metodo oCleImex.WriteLog("Messaggio")
<li>DATAIN
<li>DATAOU
<li>VARS</li>
</ul>
<p>DATAIN (di tipo dataset) che contiene i datatable con i dati di partenza da importare/esportare</p>
<p>DATAOU (di tipo dataset) che contiene i datatable delle tabelle/file che dovranno essere scritti in fase di export</p>
<p>VARS (di tipo hastable) che contiene le variabili globali si accede alle variabili con il comando VARS! ... , che sono (n è il numero di livello di relazione):</p>
<ul>
<li>VARS!glProfilo: è una variabile contenente il numero del profilo in esecuzione
<li>VARS!gnLivRel: è una variabile contenente il numero della relazione attualmente in valutazione del profilo in esecuzione
<li>VARS!IenNomeTabIn: è una variabile contenente il nome della tabella da cui leggere i datiVARS!IenNomeTabOu: è una variabile contenente il nome della tabella in cui scrivere i dati
<li>VARS!IeDataIn: datatable dei dati di partenza da importare/esportare, correntemente valutato (contenuto in DATAIN, meglio usare DATAIN.Tables(VARS!IenNomeTabIn.tostring))
<li>VARS!IenDataTable: datatable della tabella/file che dovrà essere scritto in fase di export correntemente valutato, n è il numero di livello (contenuto in DATAOU, meglio usare DATAOU.Tables(VARS!IenNomeTabOu.tostring))
<li>VARS!IenNomeFileExt: è una variabile stringa contenente il nome del file ASCII esterno utilizzato per l'import/export; la stringa contiene il nome del file con l'estensione e la path
<li>VARS!IenSqlWhere: contiene la clausola where quando il tipo filtro impostato per il processo è di tipo "esteso", fornito cioè dell'utente. La variabile di tipo stringa è modificabile unicamente all'interno dello script associato all'evento "Initialize" per sovrascrivere l'eventuale filtro fronito dal cliente. la variabile vale "" (stringa vuota) quando la tipologia di filtro della corrispondenza tabella è diversa da "filtro esteso"
<li>VARS!IeCancelRow: è una variabile usata in BeforeInsert e BeforeUpdate: se impostata = true, la riga che si sta trattando non verrà salvata nel database
<li>VARS!IeCancelRel: è una variabile usata in BeforeInsert e BeforeUpdate: se impostata = true, la relazione tra la tabella in analisi e quelle in 'relazioni tabelle' non viene applicata: (ex: relazione testmag -&gt; movmag: non apre il processo di scrittura di movmag)
<li>VARS!IECancelAll: è una variabile che se in viene impostata = true, al termine della routine Initialize oppure BeforeAll l'importazione termina, nelle altre routine non viene considerata
<li>VARS!IEExitFalse: è una variabile che se viene impostata = true, al termine dell'importazione termina con messaggio di import terminato non correttamente</li>
</ul>
<p>Gli oggetti/variabili pubblici disponibili SOLO nella routine TERMINATE in tutti gli script in .NET sono:</p>
<ul>
<li>VARS!glRigheTot = righe da elaborare considerando anche le relazioni
<li>VARS!glRigheElab = righe elaborate considerando anche le relazioni
<li>VARS!glRigheIns = righe inserite considerando anche le relazioni
<li>VARS!glRigheUpd = righe aggiornate considerando anche le relazioni
<li>VARS!glRigheSalt = righe saltate considerando anche le relazioni
<li>VARS!glRigheErr = righe con errori considerando anche le relazioni
<li>VARS!lRigheTot = righe da elaborare per singolo livello
<li>VARS!lRigheElab = righe elaborate per singolo livello
<li>VARS!lRigheIns = righe inserite per singolo livello
<li>VARS!lRigheUpd = righe aggiornate per singolo livello
<li>VARS!lRigheSalt = righe saltate per singolo livello
<li>VARS!lRigheErr = righe con errori per singolo livello</li>
</ul>
<p>Un'altra categoria di variabili, utilizzabili all'interno delle procedure, sono quelle che contengono i valori dei campi del record di origine e quelle che contengono i valori dei campi di destinazione, mano a mano che vengono calcolati. Particolare attenzione è da prestare alla validità dei dati contenuti in questi variabili, soprattutto quelle che contengono i valori di destinazione. Queste variabili sono utili per eseguire operazioni particolare mediante le procedure, effettuare dei calcoli fra campi, ecc.</p>
<p>Le variabili che contengono i valori dei campi di origine, sono definite con il nome <b>VARS!IeIn(Livello relazione)Row!(Nome campo)</b> dove (Livello relazione) è un numero che identifica il livello di relazione fra le corrispondenze tabelle (da 1 a 6 possibili livelli di relazione) e (Nome campo) è il nome del campo del record di origine. Le variabili che contengono i valori dei campi di destinazione, sono definite con il nome <b>VARS!IeOu(Livello relazione)Row!(Nome campo)</b> dove (Livello relazione) è un numero che identifica il livello di relazione fra le corrispondenze tabelle e (Nome campo) è il nome del campo di destinazione; ad esempio la variabile contenente il codice del cliente di Business, durante l'esportazione di un documento di magazzino, sarà <b>VARS!IeIn1Row!</b>tm_conto, la variabile che contiene il codice dell'articolo di Business sarà VARS!IeIn2Row!mm_codart mentre la variabile che contiene lo stesso codice articolo, ma sulla destinazione, sarà VARS!IeOu2Row!articolo.</p>
<p>Le variabili di nome VARS!IeIn(Livello relazione)Row!(Nome campo) vengono impostate prima di trattare ogni record di origine e sono valide fino a quando non si passa al record successivo. Le variabili VARS!IeOu(Livello relazione)Row!(Nome campo) vengono impostate dopo le precedenti, nell'ordine indicato nella 'Corrispondenza campi'.</p>
<p>
<TABLE class=auto>
<TR>
<TD>
</TD>
<TD colSpan=6 align=center>(1° record – livello di relazione 1)</TD>
</TR>
<TR>
<TD>
</TD>
<TD colSpan=3 align=center>ORIGINE</TD>
<TD colSpan=3 align=center>DESTINAZIONE</TD>
</TR>
<TR>
<TD>
</TD>
<TD>NomeCampo</TD>
<TD>(ValoreCampo)</TD>
<TD>Variabile VARS!Ie...</TD>
<TD>NomeCampo</TD>
<TD>(ValoreCampo)</TD>
<TD>Variabile VARS!Ie...</TD>
</TR>
<TR>
<TD>1.</TD>
<TD>Tipo docum.</TD>
<TD>("B")</TD>
<TD>VARS!IeIn1Row!tm_tipork</TD>
<TD>Tipo docum.</TD>
<TD>("B")</TD>
<TD>VARS!IeOu1Row!tipo</TD>
</TR>
<TR>
<TD>2.</TD>
<TD>Anno docum.</TD>
<TD>(1998)</TD>
<TD>VARS!IeIn1Row!tm_anno</TD>
<TD>Anno docum.</TD>
<TD>(1998)</TD>
<TD>VARS!IeOu1Row!anno</TD>
</TR>
<TR>
<TD>3.</TD>
<TD>Numero docum.</TD>
<TD>(156)</TD>
<TD>VARS!IeIn1Row!tm_numdoc</TD>
<TD>Numero docum.</TD>
<TD>(156)</TD>
<TD>VARS!IeOu1Row!numero</TD>
</TR>
</TABLE>
</p>
<p>...</p>
<p>
<TABLE class=auto>
<TR>
<TD>
</TD>
<TD colSpan=6 align=center>(1° record – livello di relazione 2)</TD>
</TR>
<TR>
<TD>
</TD>
<TD colSpan=3 align=center>ORIGINE</TD>
<TD colSpan=3 align=center>DESTINAZIONE</TD>
</TR>
<TR>
<TD>
</TD>
<TD>NomeCampo</TD>
<TD>(ValoreCampo)</TD>
<TD>Variabile VARS!Ie...</TD>
<TD>NomeCampo</TD>
<TD>(ValoreCampo)</TD>
<TD>Variabile VARS!Ie...</TD>
</TR>
<TR>
<TD>1.</TD>
<TD>Riga</TD>
<TD>(1)</TD>
<TD>VARS!IeIn2Row!mm_riga</TD>
<TD>Riga</TD>
<TD>(1)</TD>
<TD>VARS!IeOu2Row!riga</TD>
</TR>
<TR>
<TD>2.</TD>
<TD>Codice articolo</TD>
<TD>("A152") </TD>
<TD>VARS!IeIn2Row!mm_codart</TD>
<TD>Codice articolo</TD>
<TD>("PRN34")</TD>
<TD>VARS!IeOu2Row!codice</TD>
</TR>
<TR>
<TD>3.</TD>
<TD>Descr. articolo</TD>
<TD>("Stamp. HP")</TD>
<TD>VARS!IeIn2Row!mm_descr</TD>
<TD>Descr. articolo</TD>
<TD>("Stamp. HP")</TD>
<TD>VARS!IeOu2Row!descr</TD>
</TR>
<TR>
<TD>4.</TD>
<TD>Quantità </TD>
<TD>(10)</TD>
<TD>VARS!IeIn2Row!mm_quant</TD>
<TD>Quantità </TD>
<TD>(10)</TD>
<TD>VARS!IeOu2Row!quant <b>(*)</b>
</TD>
</TR>
<TR>
<TD>5.</TD>
<TD>Sconto 1 </TD>
<TD>(8,50)</TD>
<TD>VARS!IeIn2Row!mm_scont1</TD>
<TD>Sconto </TD>
<TD>(8,50)</TD>
<TD>VARS!IeOu2Row!sconto</TD>
</TR>
</TABLE>
</p>
<p>......</p>
<p>
<TABLE class=auto>
<TR>
<TD>
</TD>
<TD colSpan=6 align=center>(2° record – livello di relazione 2)</TD>
</TR>
<TR>
<TD>
</TD>
<TD colSpan=3 align=center>ORIGINE</TD>
<TD colSpan=3 align=center>DESTINAZIONE</TD>
</TR>
<TR>
<TD>
</TD>
<TD>NomeCampo</TD>
<TD>(ValoreCampo)</TD>
<TD>Variabile VARS!Ie...</TD>
<TD>NomeCampo</TD>
<TD>(ValoreCampo)</TD>
<TD>Variabile VARS!Ie...</TD>
</TR>
<TR>
<TD>1.</TD>
<TD>Riga</TD>
<TD>(2)</TD>
<TD>VARS!IeIn2Row!mm_riga</TD>
<TD>Riga</TD>
<TD>(2)</TD>
<TD>VARS!IeOu2Row!riga</TD>
</TR>
<TR>
<TD>2.</TD>
<TD>Codice articolo</TD>
<TD>("B153") </TD>
<TD>VARS!IeIn2Row!mm_codart</TD>
<TD>Codice articolo</TD>
<TD>("MOU20")</TD>
<TD>VARS!IeOu2Row!codice</TD>
</TR>
<TR>
<TD>3.</TD>
<TD>Descr. articolo</TD>
<TD>("Mouse GH")</TD>
<TD>VARS!IeIn2Row!mm_descr</TD>
<TD>Descr. articolo</TD>
<TD>("Mouse GH")</TD>
<TD>VARS!IeOu2Row!descr</TD>
</TR>
<TR>
<TD>4.</TD>
<TD>Quantità </TD>
<TD>(19)</TD>
<TD>VARS!IeIn2Row!mm_quant</TD>
<TD>Quantità </TD>
<TD>(19)</TD>
<TD>VARS!IeOu2Row!quant <b>(**)</b>
</TD>
</TR>
<TR>
<TD>5.</TD>
<TD>Sconto 1 </TD>
<TD>(5)</TD>
<TD>VARS!IeIn2Row!mm_scont1</TD>
<TD>Sconto </TD>
<TD>(5)</TD>
<TD>VARS!IeOu2Row!sconto</TD>
</TR>
</TABLE>
</p>
<p>......</p>
<p>...</p>
<p>Il flusso del programma, va dall'alto al basso, da destra verso sinistra; nel momento in cui il programma determina il valore di destinazione del campo quantità del primo record (*), tutte le variabili VARS|IeOu1Row!.. (i campi testata) sono impostate come del resto le variabili VARS!IeOu2Row!riga, VARS!IeOu2Row!codice e VARS!IeOu2Row!descr, la variabile VARS!IeOu2Row!sconto <b>NON</b> è ancora impostata perché successiva in questo momento la variabile ha valore <b>Empty</b>. Nel momento (**), invece, le variabile VARS!IeOu2Row!sconto contiene un dato <b>inattendibile </b>perché si riferisce allo sconto attribuito nella riga precedente.</p>
<p>Codice per leggere ed aggiornare il numero ordine/documento:</p>
<p>Dim oCldBase as new Cld__Base 
<br>oCldBase.Init(oApp) 
<br>Dim numdoc as Integer 
<br>numdoc = oCldBase.LegNuma("DITTA", "TIPORK", "SERIE", ANNO, True) 
<br>oCldBase.AggNuma("DITTA", "TIPORK", "SERIE", ANNO, numdoc, False, True, "")</p>
<p>Codice per ricalcolare ordine/documento:</p>
<p>'L'ultimo parametro: True se deve ricalcolare anche il valore delle righe prima del totale documento 
<br>RicalcolaDoc("PROVA", "B", 2010, " ", 1, True) 'ricalcolo un DDT emesso</p>
<p>
<b>
<i>
<u>Alert</u>
</i>
</b>
</p>
<p>Vedere per esempio in merito <A href="amalert05.htm">Alert di tipo e-mail per clienti/fornitori</A>.</p>
<p>
<u>
<i>
<b>CP2</b>
</i>
</u>
</p>
<p>Solo per il CP2 è possibile inserire come precaricate delle procedure scritte in VBScript. Vedere le <A href="Leggimi.htm">Note di versione</A> in merito.</p>
</TD></TR></TABLE><TABLE border=0 cellSpacing=0 cellPadding=0><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/software-retail-negozi/"><IMG border=0 src="../images/help_home_01_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/controllo-di-gestione/"><IMG border=0 src="../images/help_home_02_Controlla.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/crm/"><IMG border=0 src="../images/help_home_03_Fidelizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/analisi-dati-datawarehouse/"><IMG border=0 src="../images/help_home_04_DWH.gif"></A></TD><TD vAlign=center width=169 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/project-management/"><IMG border=0 src="../images/help_home_05_Gestisci.gif"></A></TD><TD vAlign=center width=146 align=right><IMG border=0 src="../images/help_home_NTS_logo_up.gif"></TD></TR><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/logistica/"><IMG border=0 src="../images/help_home_06_Organizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/customer-service/"><IMG border=0 src="../images/help_home_07_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/produzione/"><IMG border=0 src="../images/help_home_08_Pianifica.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/archiviazione-documenti/"><IMG border=0 src="../images/help_home_09_Archivia.gif"></A></TD><TD vAlign=center width=169 align=right><IMG border=0 src="../images/help_home_NTS_logo_down1.gif"></TD><TD vAlign=center width=146 align=right><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_NTS_logo_down2.gif"></A></TD></TR><TR><TD width=987 colSpan=6><IMG border=0 src="../images/help_home_Line.gif"></TD></TR></TABLE></body></html>