<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<title> AM: Personalizzazione delle stampe da script</title>
<LINK rel=stylesheet type=text/css href="style_topic.css">
<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
loadImage1 = new Image();
loadImage1.src = "../images/help_home_Button_01_Roll-over.gif";
staticImage1 = new Image();
staticImage1.src = "../images/help_home_Button_01_Roll-out.gif";

loadImage2 = new Image();
loadImage2.src = "../images/help_home_Button_02_Roll-over.gif";
staticImage2 = new Image();
staticImage2.src = "../images/help_home_Button_02_Roll-out.gif";

loadImage3 = new Image();
loadImage3.src = "../images/help_home_Button_03_Roll-over.gif";
staticImage3 = new Image();
staticImage3.src = "../images/help_home_Button_03_Roll-out.gif";

loadImage4 = new Image();
loadImage4.src = "../images/help_home_Button_04_Roll-over.gif";
staticImage4 = new Image();
staticImage4.src = "../images/help_home_Button_04_Roll-out.gif";

// End -->
</SCRIPT>

</head>
<body lang=it topMargin=3>
<TABLE border=0 width=987><TR><TD vAlign=top align=right><p><FONT size=2><CODE>Data ultimo aggiornamento: <A name=hINIeDATlAGGp></A>31/10/2012</FONT><A name=hFINeDATlAGGp></A></CODE></p></TD></TR></TABLE><TABLE border=0 cellSpacing=0><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_banner.gif"></A></TD></TR></TABLE><TABLE border=0 cellSpacing=0 cellPadding=0><TR><TD align=left><A onmouseover="image1.src=loadImage1.src;" onmouseout="image1.src=staticImage1.src;" href="cose.htm"><IMG border=0 name=image1 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_01_Roll-out.gif"></A></TD><TD align=middle><A onmouseover="image2.src=loadImage2.src;" onmouseout="image2.src=staticImage2.src;" href="pc.htm"><IMG border=0 name=image2 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_02_Roll-out.gif"></A></TD><TD align=middle><A href="ambsargmod.htm"><IMG border=0 name=image3 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_03_Roll-over.gif"></A></TD><TD align=right><A onmouseover="image4.src=loadImage4.src;" onmouseout="image4.src=staticImage4.src;" href="gaguidaan.htm"><IMG border=0 name=image4 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_04_Roll-out.gif"></A></TD></TR><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_Button_03_Roll-over-row.gif"></A></TD></TR><TR><TD bgColor=#009ee2 height=53 vAlign=center width=987 colSpan=4 align=left><p><FONT class=title color=white size=6><b>Personalizzazione delle stampe da script</b></FONT></p></TD></TR><TR><TD vAlign=center colSpan=4 align=left></TD></TR></TABLE><TABLE border=0 width=987><TR><TD><p>Per lavorare con la personalizzazione delle stampe tramite scripting basta settare l'opzione nella ReportsX del layout di stampa del programma desiderato 'Scripting = 0/-1', utilizzata per attivare o meno il motore di script in fase di stampa. Ad esempio nel caso volessimo settare l'attivazione dello scripting per il programma delle forme di pagamento imposteremo:</p><p><IMG src="../images/help_ampers04_01.jpg"></p><p>Il motore di script viene caricato nella ReportPeInit, quindi ogni volta che viene lanciata una stampa. Tale motore usa il file BE__CRPE.NTS che deve essere presente nella script del server (esattamente come per gli altri file di script).</p><p><IMG src="../images/help_ampers04_02.jpg"></p><p>Impostando ad esempio il seguente codice all'interno del file BE__CRPE:</p><p><CODE>&lt;nts&gt;<br>&lt;reference assembly="BD__BASE.dll" /&gt;</CODE></p><PRE><CODE>&lt;scriptCode&gt;&lt;![CDATA[</CODE></PRE><PRE><CODE>Imports Microsoft.VisualBasic<br>Imports System<br>Imports System.Collections.Generic<br>Imports System.Data<br>Imports NTSInformatica.CLN__STD<br>Imports NTSInformatica<br>Imports NTSInformatica.CLD__BASE<br>Imports System.IO</CODE></PRE><PRE><CODE>Public Class BE__CRPEVBS<br>  Implements INT__SCRIPT</CODE></PRE><PRE><CODE>  Dim oCldBase As CLD__BASE<br>  Dim fErr As StreamWriter = Nothing<br>  Dim fiErr As FileInfo = Nothing<br>  Dim strNomeFileLog As String = ""</CODE></PRE><PRE><CODE>  Public Function Exec(ByVal strCommand As String, ByRef oApp As Object, _<br>                       ByRef oIn As Object, _<br>        ByRef oParam As Object) As Object Implements INT__SCRIPT.Exec<br>    '------------------------------------<br>    'PARAMETRI PASSATI DAL CHIAMANTE  <br>    Dim arParam As New List(Of Object)<br>    'arParam.Add(oFrmParent)<br>    'arParam.Add(strkey1)<br>    'arParam.Add(strkey2)<br>    'arParam.Add(nIndex)<br>    'arParam.Add(strTipoDoc)<br>    'arParam.Add(bDefault)<br>    '------------------------------------<br>    Try<br>      strNomeFileLog = oApp.ServerDir &amp; "\Script\BE__CRPE.LOG"<br>      fiErr = New FileInfo(strNomeFileLog)<br>      If fiErr.Exists Then<br>        If fiErr.Length &gt; 500000 Then fiErr.Delete()<br>      End If<br>      fErr = New StreamWriter(strNomeFileLog, True)<br>      fErr.Write(strCommand &amp; vbCrLf)<br>      fErr.Flush()<br>      fErr.Close()</CODE></PRE><PRE><CODE>      oCldBase = New CLD__BASE<br>      oCldBase.Init(oApp)</CODE></PRE><PRE><CODE>      arParam = oIn</CODE></PRE><PRE><CODE>      Select Case strCommand.ToUpper()<br>        'Case "template_ReportSelectedCond".ToUpper()<br>        '  Return template_ReportSelectedCond(CType(arParam(4), String), oApp)<br>        'Case "template_ReportNameCond".ToUpper()<br>        '  Return template_ReportNameCond(CType(arParam(4), String), oApp)<br>        'Case "template_PrinterNameCond".ToUpper()<br>        '  Return template_PrinterNameCond(CType(arParam(4), String), oApp)<br>        'Case "template_ScriptPrint".ToUpper()<br>        '  Return template_ScriptPrint(CType(arParam(4), String), oApp)<br>        'Case "template_PaperSizeCond".ToUpper()<br>        '  Return template_PaperSizeCond(CType(arParam(4), String), oApp)<br>        'Case "template_CopiesCond".ToUpper()<br>        '  Return template_CopiesCond(CType(arParam(4), String), oApp)<br>      End Select</CODE></PRE><PRE><CODE>      Return Nothing</CODE></PRE><PRE><CODE>    Catch ex As Exception<br>      Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>      Return Nothing<br>    End Try<br>  End Function</CODE></PRE><PRE><CODE>  'Private Function template_ReportSelectedCond(ByVal strTipoDoc As String, ByRef oApp As Object) As String<br>  '  Try<br>  '    Return Nothing<br>  '  Catch ex As Exception<br>  '    Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>  '    Return Nothing<br>  '  End Try<br>  'End Function</CODE></PRE><PRE><CODE>  'Private Function template_ReportNameCond(ByVal strTipoDoc As String, ByRef oApp As Object) As String<br>  '  Try<br>  '    Return Nothing<br>  '  Catch ex As Exception<br>  '    Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>  '    Return Nothing<br>  '  End Try<br>  'End Function</CODE></PRE><PRE><CODE>  'Private Function template_PrinterNameCond(ByVal strTipoDoc As String, ByRef oApp As Object) As String<br>  '  Try<br>  '    Return Nothing<br>  '  Catch ex As Exception<br>  '    Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>  '    Return Nothing<br>  '  End Try<br>  'End Function</CODE></PRE><PRE><CODE>  'Private Function template_ScriptPrint(ByVal strTipoDoc As String, ByRef oApp As Object) As Boolean<br>  '  Try<br>  '    Return Nothing<br>  '  Catch ex As Exception<br>  '    Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>  '    Return Nothing<br>  '  End Try<br>  'End Function</CODE></PRE><PRE><CODE><PRE><CODE>  'Private Function template_PaperSizeCond(ByVal strTipoDoc As String, ByRef oApp As Object) As String<br>  '  Try<br>  '    Return Nothing<br>  '  Catch ex As Exception<br>  '    Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>  '    Return Nothing<br>  '  End Try<br>  'End Function</CODE></PRE><PRE><CODE></CODE></PRE><PRE><CODE><PRE><CODE>  'Private Function template_CopiesCond(ByVal strTipoDoc As String, ByRef oApp As Object) As String<br>  '  Try<br>  '    Return Nothing<br>  '  Catch ex As Exception<br>  '    Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>  '    Return Nothing<br>  '  End Try<br>  'End Function</CODE></PRE></CODE></PRE><br><br>End Class</CODE></PRE><PRE><CODE>]]&gt;&lt;/scriptCode&gt;<br>&lt;/nts&gt;</CODE></PRE><p>Noteremo che rilanciando la stampa del repor delle forme di pagamento, se abbiamo impostato lo script precedente in BE__CRPE, verrà prodotto il seguente file di LOG:</p><p><IMG src="../images/help_ampers04_03.jpg"></p><p>Possiamo di voler usare uno degli eventi indicati (<b>BS--PAGA_Reports1_Rep1_PrinterNameCond</b>) per impostare ad esempio un certo nome di stampante, nel codice precedente aggiungeremo un case compiando l'evento voluto dal file di LOG:</p><PRE><CODE>        '  Return template_PaperSizeCond(CType(arParam(4), String), oApp)<br>        'Case "template_ScriptPrint".ToUpper()<br>        '  Return template_ScriptPrint(CType(arParam(4), String), oApp)<br><b>        Case "BS--PAGA_Reports1_Rep1_PrinterNameCond".ToUpper()<br>          Return BS__PAGA_Reports1_Rep1_PrinterNameCond(CType(arParam(4), String), oApp)<br></b>      End Select</CODE></PRE><PRE><CODE>      Return Nothing</CODE></PRE><PRE><CODE>    Catch ex As Exception<br>      Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>      Return Nothing<br>    End Try<br>  End Function</CODE></PRE><PRE><CODE><b>  Private Function BS__PAGA_Reports1_Rep1_PrinterNameCond(ByVal strTipoDoc As String, _<br></b></CODE><CODE><b>                                                          ByRef oApp As Object) As String<br>    Try<br>      Return "PDF995"<br>    Catch ex As Exception<br>      Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>      Return Nothing<br>    End Try<br>  End Function</b></CODE></PRE><PRE><CODE>  'Private Function template_ReportSelectedCond(ByVal strTipoDoc As String, ByRef oApp As Object) As String<br>  '  Try<br>  '    Return Nothing<br>  '  Catch ex As Exception</CODE></PRE><p><b><i><U>Esempio di conversione di una funzione da scripting vb6 (supportato dal precedente classic start) a script .NET</U></i></b></p><p>Scripting vb6:</p><PRE><CODE>ReportSelectedCond=Function ReportSelectedCond()<br>  Dim strSQL, snaTest<br>  ReportSelectedCond = False<br>  strSQL = "SELECT Count(*) " &amp; _<br>           "FROM movmag " &amp; _<br>           "WHERE mm_tipork = '" &amp; fmOwner.strTmTipork &amp; "' " &amp; _<br>           "AND mm_anno = " &amp; fmOwner.nTmAnno &amp; " " &amp; _<br>           "AND mm_serie = '" &amp; fmOwner.strTmSerie &amp; "' " &amp; _<br>           "AND mm_numdoc = " &amp; fmOwner.lTmNumdoc &amp; " " &amp; _<br>           "AND Ucase(Mid(mm_codart, 1, 3)) = 'MOC'"<br>  If gstrSubDataType = "(Nessuno)" Then<br>    Set snaTest = gdb.OpenRecordset(strSQL, 4)<br>  Else<br>    Set snaTest = gcn.OpenRecordset(strSQL, 4)<br>  End If<br>  If Not snaTest.EOF Then<br>    If Not IsNull(snaTest(0)) Then<br>      If snaTest(0) &gt; 0 Then ReportSelectedCond = True <br>    End if<br>  End If<br>  snaTest.Close<br>  Set snaTest = Nothing<br>End Function [#A]</CODE></PRE><p>Script .NET:</p><PRE><CODE>      Select Case strCommand.ToUpper()<br>        Case "BSVEBOLL_Reports1_Rep3_ReportSelectedCond".ToUpper()<br>          Return BSVEBOLL_Reports1_Rep3_ReportSelectedCond(CType(arParam(4), String), arParam(0), _<br>                                                           CType(arParam(5), String), oApp)<br>      End Select</CODE></PRE><PRE><CODE>      Return Nothing<br>    Catch ex As Exception<br>      Dim strErr As String = CLN__STD.GestError(ex, Nothing, "", oApp.InfoError, oApp.ErrorLogFile, True)<br>      Return Nothing<br>    End Try<br>  End Function</CODE></PRE><PRE><CODE>  Private Function BSVEBOLL_Reports1_Rep3_ReportSelectedCond(ByVal strTipoDoc As String, _<br>                                        ByVal oFrmParent As Object, _<br>                ByVal oDefault As String, _<br>                ByRef oApp As Object) As String<br>    Dim strSQL As String = ""<br>    Try<br>      If strTipoDoc.ToUpper = "A" Then<br>        If Not oFrmParent Is Nothing Then<br>          If oFrmParent.Name = "FRMVEBOLL" Then<br>            strSQL = "SELECT *" &amp; _<br>                     "FROM movmag " &amp; _<br>                     "WHERE mm_tipork = '" &amp; oFrmParent.cbTipoDoc.SelectedValue &amp; "' " &amp; _<br>                     "AND mm_anno = " &amp; oFrmParent.edAnnoDoc.Text &amp; " " &amp; _<br>                     "AND mm_serie = '" &amp; oFrmParent.edSerieDoc.Text &amp; "' " &amp; _<br>                     "AND mm_numdoc = " &amp; oFrmParent.edNumDoc.Text &amp; " " &amp; _<br>                     "AND UPPER(substring(mm_codart, 1, 3)) = 'MOC'"<br>            Dim dttTest As New DataTable<br>            dttTest = oCldBase.OpenRecordset(strSQL, CLE__APP.DBTIPO.DBAZI)<br>            If Not dttTest Is Nothing AndAlso _<br>               dttTest.Rows.Count &gt; 0 Then<br>              Return "-1"<br>            End If<br>          End If<br>        End If<br>      End If<br>      Return "0"<br>    Catch ex As Exception<br>      Dim strErr As String = CLN__STD.GestError(ex, Nothing, strSQL, oApp.InfoError, _<br>                                                oApp.ErrorLogFile, True)<br>      Return "0"<br>    End Try<br>  End Function</CODE></PRE><p>Per ulteriori informazioni sulla realizzazione delle personalizzazioni tramite script consultare l'apposita circolare tecnica.</p></TD></TR></TABLE><TABLE border=0 cellSpacing=0 cellPadding=0><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/software-retail-negozi/"><IMG border=0 src="../images/help_home_01_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/controllo-di-gestione/"><IMG border=0 src="../images/help_home_02_Controlla.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/crm/"><IMG border=0 src="../images/help_home_03_Fidelizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/analisi-dati-datawarehouse/"><IMG border=0 src="../images/help_home_04_DWH.gif"></A></TD><TD vAlign=center width=169 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/project-management/"><IMG border=0 src="../images/help_home_05_Gestisci.gif"></A></TD><TD vAlign=center width=146 align=right><IMG border=0 src="../images/help_home_NTS_logo_up.gif"></TD></TR><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/logistica/"><IMG border=0 src="../images/help_home_06_Organizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/customer-service/"><IMG border=0 src="../images/help_home_07_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/produzione/"><IMG border=0 src="../images/help_home_08_Pianifica.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/archiviazione-documenti/"><IMG border=0 src="../images/help_home_09_Archivia.gif"></A></TD><TD vAlign=center width=169 align=right><IMG border=0 src="../images/help_home_NTS_logo_down1.gif"></TD><TD vAlign=center width=146 align=right><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_NTS_logo_down2.gif"></A></TD></TR><TR><TD width=987 colSpan=6><IMG border=0 src="../images/help_home_Line.gif"></TD></TR></TABLE></body></html>