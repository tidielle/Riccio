<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>
<title> AM: Personalizzazione stampe da Crystal Report</title>
<LINK rel=stylesheet type=text/css href="style_topic.css">
<SCRIPT LANGUAGE="JavaScript">
<!-- Begin
loadImage1 = new Image();
loadImage1.src = "../images/help_home_Button_01_Roll-over.gif";
staticImage1 = new Image();
staticImage1.src = "../images/help_home_Button_01_Roll-out.gif";

loadImage2 = new Image();
loadImage2.src = "../images/help_home_Button_02_Roll-over.gif";
staticImage2 = new Image();
staticImage2.src = "../images/help_home_Button_02_Roll-out.gif";

loadImage3 = new Image();
loadImage3.src = "../images/help_home_Button_03_Roll-over.gif";
staticImage3 = new Image();
staticImage3.src = "../images/help_home_Button_03_Roll-out.gif";

loadImage4 = new Image();
loadImage4.src = "../images/help_home_Button_04_Roll-over.gif";
staticImage4 = new Image();
staticImage4.src = "../images/help_home_Button_04_Roll-out.gif";

// End -->
</SCRIPT>

</head>
<body lang=it topMargin=3>
<TABLE width=987 border=0><TR><TD vAlign=top align=right><p><code>Data ultimo aggiornamento: <A name=hINIeDATlAGGp></A>06/05/2016</FONT><A name=hFINeDATlAGGp></A></code></p></TD></TR></TABLE><TABLE cellSpacing=0 border=0><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_banner.gif"></A></TD></TR></TABLE><TABLE cellSpacing=0 cellPadding=0 border=0><TR><TD align=left><A onmouseover="image1.src=loadImage1.src;" onmouseout="image1.src=staticImage1.src;" href="cose.htm"><IMG border=0 name=image1 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_01_Roll-out.gif"></A></TD><TD align=center><A onmouseover="image2.src=loadImage2.src;" onmouseout="image2.src=staticImage2.src;" href="pc.htm"><IMG border=0 name=image2 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_02_Roll-out.gif"></A></TD><TD align=center><A href="ambsargmod.htm"><IMG border=0 name=image3 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_03_Roll-over.gif"></A></TD><TD align=right><A onmouseover="image4.src=loadImage4.src;" onmouseout="image4.src=staticImage4.src;" href="gaguidaan.htm"><IMG border=0 name=image4 alt="Clicca per accedere all'argomento" src="../images/help_home_Button_04_Roll-out.gif"></A></TD></TR><TR><TD colSpan=4><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_Button_03_Roll-over-row.gif"></A></TD></TR><TR><TD bgColor=#009ee2 height=53 vAlign=middle width=987 colSpan=4 align=left><p><FONT class=title color=white size=6><b>Personalizzazione stampe da Crystal Report</b></FONT></p></TD></TR><TR><TD vAlign=middle colSpan=4 align=left></TD></TR></TABLE><TABLE width=987 border=0>
<TR>
<TD>
<p>In questo paragrafo non trattiamo della possibilità di personalizzare talune stampe (come per esempio quelle dello scadenziario, degli ordini, ecc...) con l'ausilio dei modelli di Word trattato invece diffusamente in <A href="amoffice.htm">Integrazione con Office</A>.</p>
<p>Parliamo qui di tutte le stampe (i report) prodotte da Business, le quali sono modificabili dall'utente (utente esperto) o dall'installatore o da un programmatore. La modifica può riguardare la grafica (per esempio l'aggiunta di un logo sul tracciato della bolla o della fattura), i campi (per esempio l'aggiunta di un campo nella stampa dei partitari), l'ordinamento delle informazioni (cambiare dall'ordine alfabetico all'ordine di codice o viceversa), oppure solo in alcune occasioni i filtri.</p>
<p>Per operare tali modifiche/personalizzazioni occorre disporre e saper utilizzare uno strumento denominato Crystal Report.</p>
<p>Tutti i report forniti con Business (i report standard, che vengono aggiornati con rilasci successivi della procedura) risiedono in una sottocartella <code>Rpt</code> della directory di installazione di Business, se l'installazione è una installazione client/server, tale cartella risiede solo nel server. Ogni report consiste in un file con estensione <code>.RPT</code> (per esempio <code>BSVEFATI.RPT</code> è il report della fattura immediata).</p>
<p>E' possibile modificare/personalizzare qualsiasi report tra quelli forniti da Business (anche se in alcuni casi questo può essere sconsigliato, come nel caso dei report relativi al Libro Giornale, registri IVA, ecc...). In tal caso, per evitare che al successivo aggiornamento vengano sovrascritti, è bene che i report modificati siano depositati nella sottodirectory <code>Pers</code> della directory <code>Rpt</code>, infatti Business prima di stampare un report lo cerca prima nella cartella <code>Pers</code>, e se lo trova utilizza, in caso contrario lo cerca nella <code>Rpt</code> ed utilizza quello ivi depositato.</p>
<p>E' possibile anche creare nuovi report ed agganciarli a Business con il sistema dell'<A href="bs--istp.htm">Impostazione stampe/visualizzazioni parametriche</A>. I file <code>PAR<i>????</i>.RPT</code> che si trovano nella directory <code>Rpt</code> sono esempi di report agganciati a Business col sistema delle stampe parametriche. Anche i nuovi report eventualmente creati è bene che siano depositati nella sottodirectory <code>Pers</code>.</p>
<p>E' possibile creare dei report aggiuntivi ed associarli tramite multireport con l'impostazione da Registro di Business (vedi in dettaglio l'argomento relativo in <A href="ampers08.htm">Personalizzazione delle stampe da Registro</A>). In tal modo è possibile per esempio prevedere (ma non solo) la possibilità di stampare, a scelta dell'utente, una qualsiasi stampa in formati diversi a secondo dello scopo o dell'utilizzatore o del destinatario.</p>
<p>Con le runtime Crystal report 2011 non è possibile ottenere dal report il valore predefinito impostato per i campi parametro, ma è possibile settarlo (ed acquisirlo da Business) creando sul report una formula che si chiama come il campo parametro + '_default' che contiene il valore di default. Ad esempio immaginiamo di avere il parametro prova_stampa, nome della formula prova_stampa_default. Se la formula non esiste non verrà proposto il valore di default.</p>
<p>E' importante sapere che ogni report modificato o creato può contenere le seguenti Formule inizializzate con una stringa qualsiasi (per il concetto di Formula vedi il manuale di Crystal Report), tali Formule se esistono nel report vengono riempite da Business automaticamente al momento della stampa con le informazioni descritte a lato del nome di ciascuna formula:</p>
<ul>
<li>
<u>CAPAZ</u> - cap ditta corrente impostata in anagrafica ditta
<li>
<u>CITTAAZ</u> - città ditta corrente impostata in anagrafica ditta
<li>
<u>CODFISCAZ</u> - codice fiscale ditta corrente impostata in anagrafica ditta
<li>
<u>DECSUPRZUN</u> - il numero dei decimali da utilizzarsi per i prezzi unitari in valuta corrente
<li>
<u>DECSUPRZUNVAL</u> - il numero dei decimali da utilizzarsi per i prezzi unitari in valuta
<li>
<u>DESAZ</u> - il codice azienda corrente dell'archivio sulla quale la stampa è stata prodotta
<li>
<u>FILESTAMPA</u> - il nome del file <code>.RPT</code> che è stato preso in input dal programma per effettuare la stampa
<li>
<u>INDIRAZ</u> - indirizzo ditta corrente impostata in anagrafica ditta
<li>
<u>NTSCOPIES</u> - permette di impostare il numero delle copie di stampa direttamente in fase di disegno del report
<li>
<b>
<u>NTSIMAGESDIR</u> - corrisponde al percorso della RptDir - 'Rpt' + 'Images', riporta quindi il percorso della directory delle immagini Images, in questo modo con Crystal Report versione 2008 è possibile esporre delle immagini a runtime (per esempio per ottenere un catalogo)</b>
<li>
<u>NTSORIENTATION</u> - permette di impostare in fase di disegno del report l'orientamento della stampa, indicando 1 la stampa verrà eseguita in formato portrait, mentre con valore 2 verrà eseguita in landscape
<li>
<u>NTSSUBREPORTS</u> - impostata con valore -1 abilita la gestione dei sottoreport
<li>
<u>NTSTREE</u> - impostata con valore 1 permette nell'anteprima a video di visualizzare nella parte sinistra un albero contenente i gruppi dichiarati nel report per facilitare la navigazione
<li>
<u>OPERAT</u> - il nome dell'operatore che ha lanciato la stampa
<li>
<u>PIVAAZ</u> - partiva IVA ditta corrente impostata in anagrafica ditta
<li>
<u>PROVAZ</u> - provincia ditta corrente impostata in anagrafica ditta
<li>
<u>RAGSOC2AZ</u> - ragione sociale parte estesa della ditta corrente impostata in anagrafica ditta
<li>
<u>RAGSOCAZ</u> - ragione sociale della ditta corrente impostata in anagrafica ditta
<li>
<u>VALUTA</u> - contiene la sigla della valuta di conto utilizzata (per esempio 'EUR' = Euro)</li>
</ul>
<p>Dette formule possono essere anche nascoste. Per esempio la formula <u>VALUTA</u> normalmente è nascosta e viene utilizzata all'interno di altre formule per la formattazione di importi, con o senza i due decimali.</p>
<p>Altre formule sono riempite automaticamente da Business al momento della richiesta di stampa, se sono definite in un report collegato a Business tramite il sistema delle <A href="bs--spar.htm">Stampe/visualizzazioni parametriche</A>. Queste formule sono le seguenti:</p>
<ul>
<li>
<u>FORMSTAMPA</u> - numero identificativo del formato di stampa nell'archivio delle stampe parametriche(per esempio '022')
<li>
<u>NOMESTAMPA</u> - titolo del formato di stampa (per esempio 'STAMPA PIANO DEI CONTI PERSONALIZZATO')
<li>
<u>FILTRO1</u> - valore del valore assegnato dall'utente al primo filtro
<li>
<u>FILTRO2</u> - valore del valore assegnato dall'utente al secondo filtro
<li>...
<li>
<u>FILTRO10</u> - valore del valore assegnato dall'utente al decimo filtro</li>
</ul>
<p>Mentre per le <A href="bs--spaf.htm">Stampe parametriche predefinite</A> le formule sono:</p>
<ul>
<li>
<u>REPORTHEADER</u> - contiene la stringa contenente il titolo della stampa
<li>
<u>INTESTAZIONECAMPI</u> - contiene la stringa contenente l'intestazione delle colonne</li>
</ul>
<p>Altre importanti impostazioni da seguire nella creazione di nuovi report per Business sono le seguenti (opzioni di Crystal Report e opzioni di Report):</p>
<ul>
<li>spuntare la casella More Report Engine Error Message, perché vengano fornite a Business maggiori informazioni diagnostiche su eventuali errori in fase di stampa
<li>togliere la spunta a Save Data with Report
<li>spuntare la casella Case-insensitive Data
<li>scegliere l'opzione Converti campi data/ora in Data
<li>per il formato dei campi valuta non utilizzare quelli dei Windows, bensì utilizzare un formato senza prefisso/suffisso del simbolo monetario
<li>impostare i margini di pagina (Page Setup) con i valori (espressi in cm) 1,63 0,63 2,63 1,63 e non usare i margini predefiniti
<li>prima di salvare è consigliabile settare la stampante (Printer Setup) con l'opzione Nessuna Stampante (No printer)</li>
</ul>
<p>
<b>
<i>
<u>Esempio di come inserire un immagine variabile tramite la formula NTSIMAGESDIR </u>
</i>
</b>
</p>
<p>Come prima cosa occorre aprire il report da personalizzare e creare la formula 'NTSIMAGESDIR', poi procedere ad inserire un'immagine all'interno del report.</p>
<p>
<IMG src="../images/help_ampers05_01.jpg">
</p>
<p>Si consiglia di inserire un immagine di desfault come da esempio, in modo da mostre il messaggio di immagine non trovata nel caso non sia presenti in alcuni casi l'immagine.</p>
<p>
<IMG src="../images/help_ampers05_03.jpg">
</p>
<p>Inserita la nuova immagine nel report, tramite il testo destro del mouse selezionare 'Formatta grafica...'.</p>
<p>
<IMG src="../images/help_ampers05_02.jpg">
</p>
<p>Andare sul tab 'Immagine' e selezionare la formula impostabile 'Posizione grafica'.</p>
<p>
<IMG src="../images/help_ampers05_04.jpg">
</p>
<p>In questa formula decideremo di visualizzare anzichè l'immagine di default selezionata in precedenza, una a piacere, ad esempio inserendo la seguente:</p>
<p>
<IMG src="../images/help_ampers05_06.jpg">
</p>
<p>Nel caso in cui la formula non riporta un immagine valida (nel percorso), oppure non supportata dal motore di stampa CR 2008 (nel tipo) verrà visualizzata l'immagine di default.</p>
<p>
<IMG src="../images/help_ampers05_07.jpg">
</p>
<p>
<b>
<i>
<u>Viste in crystal report 2008</u>
</i>
</b>
</p>
<p>Per conoscenza in crystal report 2008, per chi non ne è già a conoscenza, esiste la segeunte funzionalità che può essere utile. A partire da crystal report 2008 si possono aggiungere anche delle 'viste' create direttamente nel report e non nel database. Funziona con sorgente dati ODBC di tipo SQL Server, con il comando 'Aggiungi comando' è possibile inserire una query per creare una sorta di 'vista' che può essere rinominata e poi collegata alle altre tabelle.</p>
<p>
<IMG src="../images/help_ampers05_05.jpg">
</p>
<p>
<IMG src="../images/help_ampers05_08.jpg">
</p>
<p>A questo punto nel report si possono aggiungere i campi come se fosse una normale tabella.</p>
</TD></TR></TABLE><TABLE border=0 cellSpacing=0 cellPadding=0><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/software-retail-negozi/"><IMG border=0 src="../images/help_home_01_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/controllo-di-gestione/"><IMG border=0 src="../images/help_home_02_Controlla.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/crm/"><IMG border=0 src="../images/help_home_03_Fidelizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/analisi-dati-datawarehouse/"><IMG border=0 src="../images/help_home_04_DWH.gif"></A></TD><TD vAlign=center width=169 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/project-management/"><IMG border=0 src="../images/help_home_05_Gestisci.gif"></A></TD><TD vAlign=center width=146 align=right><IMG border=0 src="../images/help_home_NTS_logo_up.gif"></TD></TR><TR><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/logistica/"><IMG border=0 src="../images/help_home_06_Organizza.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/customer-service/"><IMG border=0 src="../images/help_home_07_Gestisci.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/produzione/"><IMG border=0 src="../images/help_home_08_Pianifica.gif"></A></TD><TD vAlign=center width=168 align=middle><A href="http://www.ntsinformatica.it/software-erp-medie-imprese/software-erp/archiviazione-documenti/"><IMG border=0 src="../images/help_home_09_Archivia.gif"></A></TD><TD vAlign=center width=169 align=right><IMG border=0 src="../images/help_home_NTS_logo_down1.gif"></TD><TD vAlign=center width=146 align=right><A href="http://www.ntsinformatica.it"><IMG border=0 alt="Clicca per accedere al sito di NTS Informatica" src="../images/help_home_NTS_logo_down2.gif"></A></TD></TR><TR><TD width=987 colSpan=6><IMG border=0 src="../images/help_home_Line.gif"></TD></TR></TABLE></body></html>